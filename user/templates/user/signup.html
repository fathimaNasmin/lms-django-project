{% extends 'lms_main/base.html' %}

{% load static %}
{% load crispy_forms_filters %}
{% load crispy_forms_tags %}
{% crispy signup_form %}

{% block navbar %}
    {% include 'lms_main/components/navbar.html' %}
{% endblock %}


{% block main %}

<div>
    <div id="alert-box" class="w-50 mx-auto mt-5 d-flex justify-content-center"></div>
    <div class="w-50 mx-auto mt-5 d-flex justify-content-center">
        
        
        <h4>Signup and start learning</h4>
    </div>
    <div class="w-75 mx-auto mt-5 d-flex justify-content-center">
        <form id="signup-form-id" action="{% url 'user:signup' %}" method="POST" class="w-50">
            {% csrf_token %}
            {{ form|crispy }}
            <div class="d-flex justify-content-center">
                <button type="submit" id="signup-button" class="btn btn-warning mt-3">Sign Up</button>
            </div>
        </form>
        
        <p class="text-danger">{{form.errors}}</p>
    </div>
</div>

    <!---=======Ajax cdn=======-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>


<script type="text/javascript">
    const alertBox = document.getElementById("alert-box")

    const handleAlert= (type, text)=>{
        alertBox.innerHTML = `<div class="alert alert-${type}" role="alert">
                                ${text}
                                </div>`
    }

    $(document).on('submit',"#signup-form-id", function(event){
        event.preventDefault();
        
        var signup_form_id =  $("#signup-form-id")
        $.ajax({
            url:"{% url 'user:signup' %}",
            type:  "POST",
            header: {'X-CSRFToken': '{% csrf_token %}'},
            data: signup_form_id.serialize(),
            dataType: 'json',
            success: function(response){
                var success = response['success']
                if (success){
                    // alert("User created successfully")
                    handleAlert('success', "Account created Successfully")
                    setTimeout(() => {
                        alertBox.innerHTML = ""
                    }, 3000)
                }
                else{
                    handleAlert('danger', 'Failed to create account')
                    setTimeout(() => {
                        alertBox.innerHTML = ""
                    }, 5000)
                }
            },
            failure:function(error){
                alert("Error occured while calling django view")
            }

        })
    })

</script>

{% endblock %}


{% include 'lms_main/components/footer.html' %}